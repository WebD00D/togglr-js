{"version":3,"file":"index.modern.js","sources":["../src/database.js","../src/index.js"],"sourcesContent":["import firebase from 'firebase'\n\nlet database // will contain current environment db config.\n\nvar firebaseConfig = {\n  apiKey: 'AIzaSyB0pXi3EBdc9p33uQvDMQG6SeCeuzpcHDk',\n  authDomain: 'react-togglr.firebaseapp.com',\n  databaseURL: 'https://react-togglr.firebaseio.com',\n  projectId: 'react-togglr',\n  storageBucket: 'react-togglr.appspot.com',\n  messagingSenderId: '883468833586',\n  appId: '1:883468833586:web:cf53cab617302ab2f87d2b',\n  measurementId: 'G-NHR0E20SST'\n}\n\ndatabase = firebase.initializeApp(firebaseConfig)\nfirebase.analytics()\n\nexport default database\n","import React, { useEffect, useState, useContext } from 'react'\n\nimport database from './database'\n\nconst FeatureFlagContext = React.createContext([])\n\nexport const FeatureFlagProvider = ({\n  organizationKey,\n  environment,\n  children\n}) => {\n  const [flagsRetrieved, setFlagsRetrieved] = useState({})\n\n  useEffect(() => {\n    if (!organizationKey) {\n      console.error('togglr-js configiration error: No organizationKey set')\n      return\n    }\n\n    const clientFlags = database\n      .database()\n      .ref(`organizations/${organizationKey}/flags`)\n\n    clientFlags.on('value', (snapshot) => {\n      const flags = snapshot.val()\n\n      if (flags) {\n        setFlagsRetrieved(flags)\n      } else {\n        setFlagsRetrieved({})\n      }\n    })\n  }, [])\n\n  const FLAG_CONTEXT_DATA = {\n    environment,\n    flags: flagsRetrieved\n  }\n\n  return (\n    <FeatureFlagContext.Provider value={FLAG_CONTEXT_DATA}>\n      {children}\n    </FeatureFlagContext.Provider>\n  )\n}\n\nexport const FeatureFlag = ({ flagName = '', children }) => {\n  const context = useContext(FeatureFlagContext)\n  if (!Object.keys(context.flags).length) return null\n\n  let on = false\n\n  Object.keys(context.flags).forEach((key) => {\n    const flag = context.flags[key]\n    if (flag.flagKeyName === flagName && flag.active) {\n      if (flag.environments === '') {\n        // configured for all environements\n        on = true\n      } else {\n        // configured for specifics only\n        const envArray = flag.environments.split(',')\n        if (envArray.includes(context.environment)) {\n          on = true\n        }\n      }\n    }\n  })\n\n  return on ? children : null\n}\n"],"names":["database","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","firebase","initializeApp","analytics","FeatureFlagContext","React","createContext","FeatureFlagProvider","organizationKey","environment","children","flagsRetrieved","setFlagsRetrieved","useState","useEffect","console","error","clientFlags","ref","on","snapshot","flags","val","FLAG_CONTEXT_DATA","FeatureFlag","flagName","context","useContext","Object","keys","length","forEach","key","flag","flagKeyName","active","environments","envArray","split","includes"],"mappings":";;;AAEA,IAAIA,QAAJ;AAEA,IAAIC,cAAc,GAAG;AACnBC,EAAAA,MAAM,EAAE,yCADW;AAEnBC,EAAAA,UAAU,EAAE,8BAFO;AAGnBC,EAAAA,WAAW,EAAE,qCAHM;AAInBC,EAAAA,SAAS,EAAE,cAJQ;AAKnBC,EAAAA,aAAa,EAAE,0BALI;AAMnBC,EAAAA,iBAAiB,EAAE,cANA;AAOnBC,EAAAA,KAAK,EAAE,2CAPY;AAQnBC,EAAAA,aAAa,EAAE;AARI,CAArB;AAWAT,QAAQ,GAAGU,QAAQ,CAACC,aAAT,CAAuBV,cAAvB,CAAX;AACAS,QAAQ,CAACE,SAAT;AAEA,iBAAeZ,QAAf;;ACdA,MAAMa,kBAAkB,GAAGC,KAAK,CAACC,aAAN,CAAoB,EAApB,CAA3B;AAEA,MAAaC,mBAAmB,GAAG,CAAC;AAClCC,EAAAA,eADkC;AAElCC,EAAAA,WAFkC;AAGlCC,EAAAA;AAHkC,CAAD,KAI7B;AACJ,QAAM,CAACC,cAAD,EAAiBC,iBAAjB,IAAsCC,QAAQ,CAAC,EAAD,CAApD;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAACN,eAAL,EAAsB;AACpBO,MAAAA,OAAO,CAACC,KAAR,CAAc,uDAAd;AACA;AACD;;AAED,UAAMC,WAAW,GAAG1B,UAAQ,CACzBA,QADiB,GAEjB2B,GAFiB,CAEZ,iBAAgBV,eAAgB,QAFpB,CAApB;AAIAS,IAAAA,WAAW,CAACE,EAAZ,CAAe,OAAf,EAAyBC,QAAD,IAAc;AACpC,YAAMC,KAAK,GAAGD,QAAQ,CAACE,GAAT,EAAd;;AAEA,UAAID,KAAJ,EAAW;AACTT,QAAAA,iBAAiB,CAACS,KAAD,CAAjB;AACD,OAFD,MAEO;AACLT,QAAAA,iBAAiB,CAAC,EAAD,CAAjB;AACD;AACF,KARD;AASD,GAnBQ,EAmBN,EAnBM,CAAT;AAqBA,QAAMW,iBAAiB,GAAG;AACxBd,IAAAA,WADwB;AAExBY,IAAAA,KAAK,EAAEV;AAFiB,GAA1B;AAKA,sBACE,oBAAC,kBAAD,CAAoB,QAApB;AAA6B,IAAA,KAAK,EAAEY;AAApC,KACGb,QADH,CADF;AAKD,CAtCM;AAwCP,MAAac,WAAW,GAAG,CAAC;AAAEC,EAAAA,QAAQ,EAARA,SAAQ,GAAG,EAAb;AAAiBf,EAAAA;AAAjB,CAAD,KAAiC;AAC1D,QAAMgB,OAAO,GAAGC,UAAU,CAACvB,kBAAD,CAA1B;AACA,MAAI,CAACwB,MAAM,CAACC,IAAP,CAAYH,OAAO,CAACL,KAApB,EAA2BS,MAAhC,EAAwC,OAAO,IAAP;AAExC,MAAIX,EAAE,GAAG,KAAT;AAEAS,EAAAA,MAAM,CAACC,IAAP,CAAYH,OAAO,CAACL,KAApB,EAA2BU,OAA3B,CAAoCC,GAAD,IAAS;AAC1C,UAAMC,IAAI,GAAGP,OAAO,CAACL,KAAR,CAAcW,GAAd,CAAb;;AACA,QAAIC,IAAI,CAACC,WAAL,KAAqBT,SAArB,IAAiCQ,IAAI,CAACE,MAA1C,EAAkD;AAChD,UAAIF,IAAI,CAACG,YAAL,KAAsB,EAA1B,EAA8B;AAE5BjB,QAAAA,EAAE,GAAG,IAAL;AACD,OAHD,MAGO;AAEL,cAAMkB,QAAQ,GAAGJ,IAAI,CAACG,YAAL,CAAkBE,KAAlB,CAAwB,GAAxB,CAAjB;;AACA,YAAID,QAAQ,CAACE,QAAT,CAAkBb,OAAO,CAACjB,WAA1B,CAAJ,EAA4C;AAC1CU,UAAAA,EAAE,GAAG,IAAL;AACD;AACF;AACF;AACF,GAdD;AAgBA,SAAOA,EAAE,GAAGT,QAAH,GAAc,IAAvB;AACD,CAvBM;;;;"}